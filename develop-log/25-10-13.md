# lyingloong-2025-10-13
completed benchmarker
test log for qwen3(benchmarker-example_usage.py):
```bash
(rocm_ai) wanghao@amdic:~/lyingloong$ bash script/qwen3-4b.sh 
[load_model_and_tokenizer] Loading model and tokenizer...
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.71it/s]
[ModelBenchmarker: __init__] Device: cuda
[ModelBenchmarker: __init__] Set num_threads to 24
[ModelBenchmarker: __init__] Set num_interop_threads to 4

=== 开始测试: Qwen3-4B ===

--- 测试配置: Qwen3-4B_输入长度_3_生成_50 ---
The following generation flags are not valid and may be ignored: ['top_k']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
  运行 1/5: 延迟=1.3845s, 生成50 tokens, 吞吐量=36.12 t/s, 显存=7.59GB
  运行 2/5: 延迟=1.3851s, 生成50 tokens, 吞吐量=36.10 t/s, 显存=7.59GB
  运行 3/5: 延迟=1.3854s, 生成50 tokens, 吞吐量=36.09 t/s, 显存=7.59GB
  运行 4/5: 延迟=1.3880s, 生成50 tokens, 吞吐量=36.02 t/s, 显存=7.59GB
  运行 5/5: 延迟=1.3874s, 生成50 tokens, 吞吐量=36.04 t/s, 显存=7.59GB

--- 测试配置: Qwen3-4B_输入长度_3_生成_100 ---
  运行 1/5: 延迟=2.7788s, 生成100 tokens, 吞吐量=35.99 t/s, 显存=7.59GB
  运行 2/5: 延迟=2.7731s, 生成100 tokens, 吞吐量=36.06 t/s, 显存=7.59GB
  运行 3/5: 延迟=2.7734s, 生成100 tokens, 吞吐量=36.06 t/s, 显存=7.59GB
  运行 4/5: 延迟=2.7754s, 生成100 tokens, 吞吐量=36.03 t/s, 显存=7.59GB
  运行 5/5: 延迟=2.7764s, 生成100 tokens, 吞吐量=36.02 t/s, 显存=7.59GB

--- 测试配置: Qwen3-4B_输入长度_26_生成_50 ---
  运行 1/5: 延迟=1.3903s, 生成50 tokens, 吞吐量=35.96 t/s, 显存=7.59GB
  运行 2/5: 延迟=1.3889s, 生成50 tokens, 吞吐量=36.00 t/s, 显存=7.59GB
  运行 3/5: 延迟=1.3881s, 生成50 tokens, 吞吐量=36.02 t/s, 显存=7.59GB
  运行 4/5: 延迟=1.3916s, 生成50 tokens, 吞吐量=35.93 t/s, 显存=7.59GB
  运行 5/5: 延迟=1.3900s, 生成50 tokens, 吞吐量=35.97 t/s, 显存=7.59GB

--- 测试配置: Qwen3-4B_输入长度_26_生成_100 ---
  运行 1/5: 延迟=2.7801s, 生成100 tokens, 吞吐量=35.97 t/s, 显存=7.60GB
  运行 2/5: 延迟=2.7818s, 生成100 tokens, 吞吐量=35.95 t/s, 显存=7.60GB
  运行 3/5: 延迟=2.7845s, 生成100 tokens, 吞吐量=35.91 t/s, 显存=7.60GB
  运行 4/5: 延迟=2.7825s, 生成100 tokens, 吞吐量=35.94 t/s, 显存=7.60GB
  运行 5/5: 延迟=2.7824s, 生成100 tokens, 吞吐量=35.94 t/s, 显存=7.60GB

================================================================================
性能测试汇总 (4 种配置)
================================================================================
配置名称                           | 平均延迟(s)      | 吞吐量(t/s)     | 峰值显存(GB)    
--------------------------------------------------------------------------------
Qwen3-4B_输入长度_3_生成_50... | 1.3861      | 36.07       | 7.59
Qwen3-4B_输入长度_3_生成_100... | 2.7754      | 36.03       | 7.59
Qwen3-4B_输入长度_26_生成_50... | 1.3898      | 35.98       | 7.59
Qwen3-4B_输入长度_26_生成_100... | 2.7823      | 35.94       | 7.60
================================================================================


=== 运行性能分析 ===
[W1013 08:49:45.645376671 collection.cpp:1116] Warning: ROCTracer produced duplicate flow start: 1 (function operator())

=== 性能分析摘要 (按CUDA时间排序) ===
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                        model_inference         0.00%       0.000us         0.00%       0.000us       0.000us        4.421s       177.21%        4.421s        4.421s           0 B           0 B           0 B           0 B             1  
                                        model_inference        31.58%        1.397s       100.00%        4.423s        4.423s       0.000us         0.00%        2.495s        2.495s           0 B         -80 B           0 B      -1.96 GB             1  
                                           aten::matmul         2.38%     105.268ms        17.43%     770.671ms      30.341us       0.000us         0.00%        1.618s      63.691us           0 B           0 B     244.21 MB           0 B         25400  
                                           aten::linear         0.89%      39.570ms        20.61%     911.323ms      36.021us       0.000us         0.00%        1.617s      63.925us           0 B           0 B     244.16 MB           0 B         25300  
                                               aten::mm        10.68%     472.111ms        12.98%     574.087ms      22.691us        1.617s        64.82%        1.617s      63.925us           0 B           0 B     244.16 MB     244.16 MB         25300  
Cijk_Alik_Bljk_HHS_BH_MT64x64x32_MI16x16x16x1_SN_1LD...         0.00%       0.000us         0.00%       0.000us       0.000us     840.779ms        33.70%     840.779ms     115.175us           0 B           0 B           0 B           0 B          7300  
Cijk_Alik_Bljk_HHS_BH_MT32x32x32_MI16x16x16x1_SN_1LD...         0.00%       0.000us         0.00%       0.000us       0.000us     508.776ms        20.39%     508.776ms      70.663us           0 B           0 B           0 B           0 B          7200  
                                              aten::mul         5.30%     234.425ms         8.08%     357.122ms       7.534us     244.510ms         9.80%     244.510ms       5.158us           0 B           0 B     356.70 MB     356.70 MB         47400  
Cijk_Alik_Bljk_HHS_BH_MT32x32x32_MI16x16x16x1_SN_1LD...         0.00%       0.000us         0.00%       0.000us       0.000us     136.221ms         5.46%     136.221ms      37.839us           0 B           0 B           0 B           0 B          3600  
void at::native::elementwise_kernel_manual_unroll<12...         0.00%       0.000us         0.00%       0.000us       0.000us     133.848ms         5.36%     133.848ms       6.176us           0 B           0 B           0 B           0 B         21673  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 4.423s
Self CUDA time total: 2.495s

[load_model_and_tokenizer] Loading model and tokenizer...
Loading checkpoint shards: 100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3/3 [00:01<00:00,  2.70it/s]
[load_model_and_tokenizer] Model quantized to int8.
[ModelBenchmarker: __init__] Device: cuda
[ModelBenchmarker: __init__] Set num_threads to 24
[ModelBenchmarker: __init__] Set num_interop_threads to 4

=== 开始测试: Qwen3-4B ===

--- 测试配置: Qwen3-4B_输入长度_3_生成_50 ---
The following generation flags are not valid and may be ignored: ['top_k']. Set `TRANSFORMERS_VERBOSITY=info` for more details.
  运行 1/5: 延迟=2.2669s, 生成50 tokens, 吞吐量=22.06 t/s, 显存=5.27GB
  运行 2/5: 延迟=2.2658s, 生成50 tokens, 吞吐量=22.07 t/s, 显存=5.27GB
  运行 3/5: 延迟=2.2669s, 生成50 tokens, 吞吐量=22.06 t/s, 显存=5.27GB
  运行 4/5: 延迟=2.2662s, 生成50 tokens, 吞吐量=22.06 t/s, 显存=5.27GB
  运行 5/5: 延迟=2.2672s, 生成50 tokens, 吞吐量=22.05 t/s, 显存=5.27GB

--- 测试配置: Qwen3-4B_输入长度_3_生成_100 ---
  运行 1/5: 延迟=4.5415s, 生成100 tokens, 吞吐量=22.02 t/s, 显存=5.28GB
  运行 2/5: 延迟=4.5456s, 生成100 tokens, 吞吐量=22.00 t/s, 显存=5.28GB
  运行 3/5: 延迟=4.5476s, 生成100 tokens, 吞吐量=21.99 t/s, 显存=5.28GB
  运行 4/5: 延迟=4.5498s, 生成100 tokens, 吞吐量=21.98 t/s, 显存=5.28GB
  运行 5/5: 延迟=4.5533s, 生成100 tokens, 吞吐量=21.96 t/s, 显存=5.28GB

--- 测试配置: Qwen3-4B_输入长度_26_生成_50 ---
  运行 1/5: 延迟=2.2808s, 生成50 tokens, 吞吐量=21.92 t/s, 显存=5.28GB
  运行 2/5: 延迟=2.2795s, 生成50 tokens, 吞吐量=21.93 t/s, 显存=5.28GB
  运行 3/5: 延迟=2.2817s, 生成50 tokens, 吞吐量=21.91 t/s, 显存=5.28GB
  运行 4/5: 延迟=2.2813s, 生成50 tokens, 吞吐量=21.92 t/s, 显存=5.28GB
  运行 5/5: 延迟=2.2824s, 生成50 tokens, 吞吐量=21.91 t/s, 显存=5.28GB

--- 测试配置: Qwen3-4B_输入长度_26_生成_100 ---
  运行 1/5: 延迟=4.5697s, 生成100 tokens, 吞吐量=21.88 t/s, 显存=5.28GB
  运行 2/5: 延迟=4.5705s, 生成100 tokens, 吞吐量=21.88 t/s, 显存=5.28GB
  运行 3/5: 延迟=4.5709s, 生成100 tokens, 吞吐量=21.88 t/s, 显存=5.28GB
  运行 4/5: 延迟=4.5700s, 生成100 tokens, 吞吐量=21.88 t/s, 显存=5.28GB
  运行 5/5: 延迟=4.5702s, 生成100 tokens, 吞吐量=21.88 t/s, 显存=5.28GB

================================================================================
性能测试汇总 (4 种配置)
================================================================================
配置名称                           | 平均延迟(s)      | 吞吐量(t/s)     | 峰值显存(GB)    
--------------------------------------------------------------------------------
Qwen3-4B_输入长度_3_生成_50... | 2.2666      | 22.06       | 5.27
Qwen3-4B_输入长度_3_生成_100... | 4.5476      | 21.99       | 5.28
Qwen3-4B_输入长度_26_生成_50... | 2.2811      | 21.92       | 5.28
Qwen3-4B_输入长度_26_生成_100... | 4.5703      | 21.88       | 5.28
================================================================================


=== 运行性能分析 ===
[W1013 08:53:34.285487971 collection.cpp:1116] Warning: ROCTracer produced duplicate flow start: 1 (function operator())

=== 性能分析摘要 (按CUDA时间排序) ===
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                        model_inference         0.00%       0.000us         0.00%       0.000us       0.000us        6.021s       146.49%        6.021s        6.021s           0 B           0 B           0 B           0 B             1  
                                        model_inference        38.23%        2.302s       100.00%        6.023s        6.023s       0.000us         0.00%        4.110s        4.110s           0 B         -64 B           0 B    -756.69 GB             1  
                                            aten::copy_         3.32%     199.709ms         6.63%     399.215ms       7.235us        2.388s        58.10%        2.388s      43.282us           0 B           0 B           0 B           0 B         55176  
                                               aten::to         0.95%      56.970ms        12.72%     766.349ms       8.035us       0.000us         0.00%        2.387s      25.032us           0 B           0 B     754.76 GB           0 B         95376  
                                         aten::_to_copy         2.63%     158.140ms        11.78%     709.379ms      12.927us       0.000us         0.00%        2.387s      43.506us           0 B           0 B     754.76 GB           0 B         54875  
void at::native::elementwise_kernel_manual_unroll<12...         0.00%       0.000us         0.00%       0.000us       0.000us        2.273s        55.29%        2.273s      89.828us           0 B           0 B           0 B           0 B         25300  
                                               aten::mm         8.01%     482.121ms         9.31%     560.678ms      22.161us     961.795ms        23.40%     961.795ms      38.016us           0 B           0 B     244.16 MB     244.16 MB         25300  
Cijk_Alik_Bljk_HHS_BH_MT64x64x32_MI16x16x16x1_SN_1LD...         0.00%       0.000us         0.00%       0.000us       0.000us     471.486ms        11.47%     471.486ms      64.587us           0 B           0 B           0 B           0 B          7300  
Cijk_Alik_Bljk_HHS_BH_MT32x32x32_MI16x16x16x1_SN_1LD...         0.00%       0.000us         0.00%       0.000us       0.000us     309.198ms         7.52%     309.198ms      42.944us           0 B           0 B           0 B           0 B          7200  
                                              aten::mul         6.45%     388.452ms         9.58%     577.103ms       7.938us     290.984ms         7.08%     290.984ms       4.003us           0 B           0 B     600.86 MB     600.86 MB         72700  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 6.023s
Self CUDA time total: 4.110s

[qwen3-4b.sh] Done.
```
